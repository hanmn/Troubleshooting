

 

 

 

 

 

 

 

 

 

Prepare reverse proxy secondary certificate in Key Vault. Please make sure this is a new Key Vault service and set its access policies as bel 

ow. I will ignore this part automation things. 

cid:image002.png@01D37B0E.D67C1110
Download SF resource group ARM template JSON 

Edit ARM template JSON by below steps. (you can achieve this target by JSObject C# code application) 

Keep all the other JSON properties and go to “resources” property. We will use below steps to edit this section only. 

Delete all the other children objects under “resources” but only keep: SF VMSS section (if there are multiple VMSS sections, please keep all of them), SF section 

You can find VMSS section by: "type": "Microsoft.Compute/virtualMachineScaleSets" 

You can find SF section by: "type": "Microsoft.ServiceFabric/clusters" 

In VMSS section, use below steps to add reverse proxy secondary certificate to VMSS configuration 

Under properties.virtualMachineProfile.osProfile.secrets list, there should already be some certificates. Add new cert Key-Vault information to this section. 

Under properties.virtualMachineProfile.extensionProfile.extensions.properties.settings, add reverse proxy secondary certificate section as below. 

  

"reverseProxySecondaryCertificate": { 

                                            "thumbprint": "[reverse proxy secondary cert thumbprint]", 

                                            "x509StoreName": "My" 

                                        }, 

  

In SF section, add below configuration in properties.reverseProxyCertificate 

  

"thumbprintSecondary": "[reverse proxy secondary cert thumbprint]", 

  

Execute Power Command as below: 

  

New-AzureRmResourceGroupDeployment -Name testReverseProxyDeployment -ResourceGroupName [SF resource group name] -TemplateFile [template file path] 

  

Above step #3 and step #4 will help you add new reverse proxy secondary certificate to current VMSS and SF. You can verify result from SFX or SF Azure portal. 

After step #4 command finished, please edit JSON template and exchange section reverse proxy and secondary certificate thumbprints which are under VMSS and SF configuration in step #3.  

Run step #4 command again, this will swap online VMSS and SF reverse proxy certificates. 

 

 

 

============================================================================================================================== 

 

Other way of performing this would be:  

 

<<template3.json>>
 

<<RE REG 117101216481984 Prem Azure Service Fabric issue related to azure service fabric client certificate and reverse proxy Initial Response.msg>>
  

Reverse Proxy Certificate Rollover steps via portal and PowerShell using exported Arm Template:- 

  

Create a new certificate in different KeyVault. Currently there is a limitation exists that Primary and Secondary secrets should be in a different Key Vault in the same region for the deployment to succeed. 

You can use the below PowerShell command to deploy the certificate to the VMSS. 

  

#Requires -Version 3.0 

Param( 

    [string] [Parameter(Mandatory=$true)] $KeyVaultResourceGroupName, 

    [string] [Parameter(Mandatory=$true)] $VmssResourceGroupName, 

    [string] [Parameter(Mandatory=$true)] $VaultName, 

    [string] [Parameter(Mandatory=$true)] $VmssName, 

    [string] [Parameter(Mandatory=$true)] $SubscriptionId 

    ,[string] [Parameter(Mandatory=$true)] $CertificateUrl 

) 

  

Set-StrictMode -Version 3 

  

$ErrorActionPreference = "Stop" 

  

# Login 

Login-AzureRmAccount -SubscriptionId $SubscriptionId 

$sourceVaultId = "/subscriptions/$SubscriptionId/resourceGroups/$KeyVaultResourceGroupName/providers/Microsoft.KeyVault/vaults/$VaultName" 

$sourceVaultId 

 

$certConfig = New-AzureRmVmssVaultCertificateConfig -CertificateUrl $CertificateUrl -CertificateStore "My" 

$certConfig 

# Get current vmss  

$vmss = Get-AzureRmVmss -ResourceGroupName $VmssResourceGroupName -VMScaleSetName $VmssName 

$vmss 

# add new secret  

$vmss = Add-AzureRmVmssSecret -VirtualMachineScaleSet $vmss -SourceVaultId $sourceVaultId -VaultCertificate $certConfig 

$vmss 

#update VMSS  

Update-AzureRmVmss -ResourceGroupName $VmssResourceGroupName -Name $VmssName -VirtualMachineScaleSet $vmss -Verbose 

  

Add new Certificate thumbprint in Secondary Certificate slot using azure resource portal (https://resources.azure.com/) 

  

Go to https://resources.azure.com and find your subscription -- > resource groups -- > providers/Microsoft.Compute/virtualMachineScaleSets -- > your VMSS 

  

Azure Resource Explorer (Preview) 
Sea 
+ providers 
— subscriptions 
— Microsoft Azure Internal Consumption 
+ providers 
— resourceGroups 
Default-Applicationlnsights-EastUS 
Default-Storage-CentralUS 
hugh 
hughbot 
hughdev 
hughsfpre 
— hughsftest 
— providers 
* Show all 
— Microsoft.Compute 
* Show all 
— virtualMachineScaleSets 
— WordCount 
instanceView 
networklnterfaces 
skus 
virtualMachines 
O
  

  

Please enable "Edit" and "Read/Write" permission 

Q Microsoft (microsoft.onmicrosoft.com) 
Data (GET, PUT) 
Actions (POST, DELETE) 
Create 
Read 
O 
Documentation 
Read,'Write 
PowerShell 
PUT 
Cancel 
https : /'management.azure.com/subscriptions/3836fb2g-16f8-4fSb-b2ba-96846ef32e3a/res
  

Add the following "certificateSecondary" settings in VMSS/extensionProfile/extensions: 

  


And click PUT. 

  

Please wait for VMSS Status under the resource group is "Succeeded" before updating the Service Fabric cluster settings: 

WordCount 
Virtual machine scale set 
p Search (Ctr/+/) 
Overview 
Activity log 
Access control (IAM) 
Tags 
Start 
Essentials 
Restart 
Deallocate 
Delete 
Resource group (change) 
hughsftest 
Status 
Succeeded 
Location 
West US 
Subscription name (change) 
Microsoft Azure Intemal Consumption
Please repeat the step a and b for the Microsoft.ServiceFabric provider for your cluster 

Add "thumbprintSecondary": "FA8709B847D12560ED37A278A8367A93F3B81D74" setting. 


  

Wait for the SF cluster as it’ll be updating the secondary certificate for reverse proxy.  

Explorer Delete 
O Updating 
Essentials 
Resource group (charge) 
hughsftest 
Status 
Updating user certificate 
Location 
West US 
Subscription name (change) 
Microsoft Azure Internal Consumption 
Subscription ID 
3036fb29-16f8-4f5b-b2ba-96046eß203a 
Service Fabric version 
5.4.1649494 
Client connection endpoint 
hughsftest.westus.cloudapp.azure.com:19000 
Node count 
Application count 
Service Fabric Explorer 
https://hughsftest.westus.cloudapp.azure.co...
Once done, you can see secondary certificate under the reverse proxy certificate section in the “Security” tab. You can swap the same from the portal.  

 

And after 5.7, there is another new algorithm. You can switch to the old algorithm by using following command 

Set-AzureRmServiceFabricSetting -ResourceGroupName rgname  -Name clustername -Section "Security" -Parameter " UseSecondaryIfNewer " -Value "false"  

 

By default UseSecondaryIfNewer is true, the ReverseProxy will use whatever cert with longest expiration date. 

Determine which cert is eventually used for reverse proxy, you can use "netsh http show SslCert" command on the rdp session with admin rights. 


Template3.json:
```json
{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "vaults_vantestsf_name": {
            "defaultValue": "vantestsf",
            "type": "String"
        },
        "clusters_vantestsf_name": {
            "defaultValue": "vantestsf",
            "type": "String"
        },
        "virtualNetworks_VNet_vantestsf_name": {
            "defaultValue": "VNet-vantestsf",
            "type": "String"
        },
        "virtualMachineScaleSets_nodetype_name": {
            "defaultValue": "nodetype",
            "type": "String"
        },
        "storageAccounts_sfdgvantestsf6389_name": {
            "defaultValue": "sfdgvantestsf6389",
            "type": "String"
        },
        "publicIPAddresses_LBIP_vantestsf_0_name": {
            "defaultValue": "LBIP-vantestsf-0",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_name": {
            "defaultValue": "LB-vantestsf-nodetype",
            "type": "String"
        },
        "storageAccounts_sflogsvantestsf3788_name": {
            "defaultValue": "sflogsvantestsf3788",
            "type": "String"
        },
        "subnets_Subnet_0_name": {
            "defaultValue": "Subnet-0",
            "type": "String"
        },
        "virtualMachineScaleSets_nodetype_id": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourcegroups/vantestcs/providers/Microsoft.KeyVault/vaults/vantestkv2",
            "type": "String"
        },
        "virtualMachineScaleSets_nodetype_id_1": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourcegroups/vantestcs/providers/Microsoft.KeyVault/vaults/vantestkv",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_1": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/backendAddressPools/LoadBalancerBEAddressPool",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_2": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/probes/FabricGatewayProbe",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_3": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_4": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/backendAddressPools/LoadBalancerBEAddressPool",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_5": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/probes/FabricHttpGatewayProbe",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_6": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_7": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_8": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_9": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_10": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        },
        "loadBalancers_LB_vantestsf_nodetype_id_11": {
            "defaultValue": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Network/loadBalancers/LB-vantestsf-nodetype/frontendIPConfigurations/LoadBalancerIPConfig",
            "type": "String"
        }
    },
    "variables": {},
    "resources": [
        {
            "comments": "Generalized from resource: '/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.Compute/virtualMachineScaleSets/nodetype'.",
            "type": "Microsoft.Compute/virtualMachineScaleSets",
            "sku": {
                "name": "Standard_A2_v2",
                "tier": "Standard",
                "capacity": 5
            },
            "name": "[parameters('virtualMachineScaleSets_nodetype_name')]",
            "apiVersion": "2017-03-30",
            "location": "southeastasia",
            "tags": {
                "resourceType": "Service Fabric",
                "clusterName": "vantestsf"
            },
            "scale": null,
            "properties": {
                "singlePlacementGroup": true,
                "upgradePolicy": {
                    "mode": "Automatic"
                },
                "virtualMachineProfile": {
                    "osProfile": {
                        "computerNamePrefix": "[parameters('virtualMachineScaleSets_nodetype_name')]",
                        "adminUsername": "gapan",
                        "windowsConfiguration": {
                            "provisionVMAgent": true,
                            "enableAutomaticUpdates": true
                        },
                        "secrets": [
                            {
                                "sourceVault": {
                                    "id": "[parameters('virtualMachineScaleSets_nodetype_id')]"
                                },
                                "vaultCertificates": [
                                    {
                                        "certificateUrl": "https://vantestkv2.vault.azure.net/secrets/vantestcert/a30882620c9d4dff807ce85dcbcc5d40",
                                        "certificateStore": "My"
                                    }
                                ]
                            },
                            {
                                "sourceVault": {
                                    "id": "[parameters('virtualMachineScaleSets_nodetype_id_1')]"
                                },
                                "vaultCertificates": [
                                    {
                                        "certificateUrl": "https://vantestkv.vault.azure.net/secrets/vantestcert2/fcf8da4c169c4904a53ffac5570ea24f",
                                        "certificateStore": "My"
                                    }
                                ]
                            },
                            {
                                "sourceVault": {
                                    "id": "[resourceId('Microsoft.KeyVault/vaults', parameters('vaults_vantestsf_name'))]"
                                },
                                "vaultCertificates": [
                                    {
                                        "certificateUrl": "https://vantestsf.vault.azure.net:443/secrets/vantestsf20171130150414/32c4c6858f594feaa1d29bc5b45a4aa7",
                                        "certificateStore": "my"
                                    },
                                    {
                                        "certificateUrl": "https://vantestsf.vault.azure.net:443/secrets/vantestsf20171201091001/a4fedeb356fe45148c45eb1ab63ec2ee",
                                        "certificateStore": "my"
                                    }
                                ]
                            },
                            {
                                "sourceVault": {
                                    "id": "/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourceGroups/vantestsf/providers/Microsoft.KeyVault/vaults/vantestsecrevproxykv"
                                },
                                "vaultCertificates": [
                                    {
                                        "certificateUrl": "https://vantestsecrevproxykv.vault.azure.net/secrets/vantestsfrevproxyseccert/db118e27e766474d9a6385b1757e100e",
                                        "certificateStore": "My"
                                    }
                                ]
                            }
                        ]
                    },
                    "storageProfile": {
                        "osDisk": {
                            "createOption": "FromImage",
                            "caching": "ReadOnly",
                            "managedDisk": {
                                "storageAccountType": "Standard_LRS"
                            }
                        },
                        "imageReference": {
                            "publisher": "MicrosoftWindowsServer",
                            "offer": "WindowsServer",
                            "sku": "2016-Datacenter",
                            "version": "latest"
                        }
                    },
                    "networkProfile": {
                        "networkInterfaceConfigurations": [
                            {
                                "name": "NIC-vantestsf-0",
                                "properties": {
                                    "primary": true,
                                    "ipConfigurations": [
                                        {
                                            "name": "NIC-vantestsf-0",
                                            "properties": {
                                                "subnet": {
                                                    "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_VNet_vantestsf_name'), parameters('subnets_Subnet_0_name'))]"
                                                },
                                                "loadBalancerBackendAddressPools": [
                                                    {
                                                        "id": "[concat(resourceId('Microsoft.Network/loadBalancers', parameters('loadBalancers_LB_vantestsf_nodetype_name')), '/backendAddressPools/LoadBalancerBEAddressPool')]"
                                                    }
                                                ],
                                                "loadBalancerInboundNatPools": [
                                                    {
                                                        "id": "[concat(resourceId('Microsoft.Network/loadBalancers', parameters('loadBalancers_LB_vantestsf_nodetype_name')), '/inboundNatPools/LoadBalancerBEAddressNatPool')]"
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    "extensionProfile": {
                        "extensions": [
                            {
                                "properties": {
                                    "publisher": "Microsoft.Azure.ServiceFabric",
                                    "type": "ServiceFabricNode",
                                    "typeHandlerVersion": "1.0",
                                    "autoUpgradeMinorVersion": true,
                                    "settings": {
                                        "clusterEndpoint": "https://southeastasia.servicefabric.azure.com/runtime/clusters/e436feed-a257-499f-a676-e8d1cd811199",
                                        "nodeTypeRef": "[parameters('virtualMachineScaleSets_nodetype_name')]",
                                        "dataPath": "D:\\\\SvcFab",
                                        "durabilityLevel": "Silver",
                                        "enableParallelJobs": true,
                                        "nicPrefixOverride": "10.0.0.0/24",
                                        "reverseProxyCertificate": {
                                            "thumbprint": "0D5877EE8C4B2210CA24650231D3ABF6366BAE11",
                                            "x509StoreName": "My"
                                        },
										"reverseProxySecondaryCertificate": {
                                            "thumbprint": "FA8709B847D12560ED37A278A8367A93F3B81D74",
                                            "x509StoreName": "My"
                                        },
                                        "certificate": {
                                            "thumbprint": "C82CD573B5CDE976B4799134F1618A80EBE57E9C",
                                            "x509StoreName": "My"
                                        },
                                        "certificateSecondary": {
                                            "thumbprint": "721422E0F6708CDB1730B81B536D12C779049C60",
                                            "x509StoreName": "my"
                                        }
                                    }
                                },
                                "name": "[concat(parameters('virtualMachineScaleSets_nodetype_name'),'_ServiceFabricNode')]"
                            },
                            {
                                "properties": {
                                    "publisher": "Microsoft.Azure.Diagnostics",
                                    "type": "IaaSDiagnostics",
                                    "typeHandlerVersion": "1.5",
                                    "autoUpgradeMinorVersion": true,
                                    "settings": {
                                        "WadCfg": {
                                            "DiagnosticMonitorConfiguration": {
                                                "overallQuotaInMB": "50000",
                                                "EtwProviders": {
                                                    "EtwEventSourceProviderConfiguration": [
                                                        {
                                                            "provider": "Microsoft-ServiceFabric-Actors",
                                                            "scheduledTransferKeywordFilter": "1",
                                                            "scheduledTransferPeriod": "PT5M",
                                                            "DefaultEvents": {
                                                                "eventDestination": "ServiceFabricReliableActorEventTable"
                                                            }
                                                        },
                                                        {
                                                            "provider": "Microsoft-ServiceFabric-Services",
                                                            "scheduledTransferPeriod": "PT5M",
                                                            "DefaultEvents": {
                                                                "eventDestination": "ServiceFabricReliableServiceEventTable"
                                                            }
                                                        }
                                                    ],
                                                    "EtwManifestProviderConfiguration": [
                                                        {
                                                            "provider": "cbd93bc2-71e5-4566-b3a7-595d8eeca6e8",
                                                            "scheduledTransferLogLevelFilter": "Information",
                                                            "scheduledTransferKeywordFilter": "4611686018427387904",
                                                            "scheduledTransferPeriod": "PT5M",
                                                            "DefaultEvents": {
                                                                "eventDestination": "ServiceFabricSystemEventTable"
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        },
                                        "StorageAccount": "sfdgvantestsf6389"
                                    }
                                },
                                "name": "[concat('VMDiagnosticsVmExt_vmNodeType0Name')]"
                            }
                        ]
                    }
                },
                "overprovision": false
            },
        },
        {
            "comments": "Generalized from resource: '/subscriptions/1bb2b862-f8fc-4d52-8a1d-a5909d5a0795/resourcegroups/vantestsf/providers/Microsoft.ServiceFabric/clusters/vantestsf'.",
            "type": "Microsoft.ServiceFabric/clusters",
            "name": "[parameters('clusters_vantestsf_name')]",
            "apiVersion": "2017-07-01-preview",
            "location": "southeastasia",
            "tags": {},
            "scale": null,
            "properties": {
                "clusterCodeVersion": "6.0.232.9494",
                "clusterState": "Ready",
                "managementEndpoint": "[concat('https://', parameters('clusters_vantestsf_name'),'.southeastasia.cloudapp.azure.com:19080')]",
                "certificate": {
                    "thumbprint": "C82CD573B5CDE976B4799134F1618A80EBE57E9C",
                    "thumbprintSecondary": "721422E0F6708CDB1730B81B536D12C779049C60",
                    "x509StoreName": "My"
                },
                "clientCertificateThumbprints": [],
                "clientCertificateCommonNames": [],
                "fabricSettings": [
                    {
                        "name": "Security",
                        "parameters": [
                            {
                                "name": "ClusterProtectionLevel",
                                "value": "EncryptAndSign"
                            }
                        ]
                    }
                ],
                "upgradeDescription": {
                    "forceRestart": false,
                    "upgradeReplicaSetCheckTimeout": "10675199.02:48:05.4775807",
                    "healthCheckWaitDuration": "00:00:30",
                    "healthCheckStableDuration": "00:00:30",
                    "healthCheckRetryTimeout": "00:05:00",
                    "upgradeTimeout": "12:00:00",
                    "upgradeDomainTimeout": "02:00:00",
                    "healthPolicy": {
                        "maxPercentUnhealthyNodes": 100,
                        "maxPercentUnhealthyApplications": 100
                    },
                    "deltaHealthPolicy": {
                        "maxPercentDeltaUnhealthyNodes": 0,
                        "maxPercentUpgradeDomainDeltaUnhealthyNodes": 0,
                        "maxPercentDeltaUnhealthyApplications": 0
                    }
                },
                "diagnosticsStorageAccountConfig": {
                    "storageAccountName": "[concat('sflogs', parameters('clusters_vantestsf_name'),'3788')]",
                    "protectedAccountKeyName": "StorageAccountKey1",
                    "blobEndpoint": "[concat('https', '://', parameters('storageAccounts_sflogsvantestsf3788_name'), '.blob.core.windows.net', '/')]",
                    "queueEndpoint": "[concat('https', '://', parameters('storageAccounts_sflogsvantestsf3788_name'), '.queue.core.windows.net', '/')]",
                    "tableEndpoint": "[concat('https', '://', parameters('storageAccounts_sflogsvantestsf3788_name'), '.table.core.windows.net', '/')]"
                },
                "nodeTypes": [
                    {
                        "name": "nodetype",
                        "clientConnectionEndpointPort": 19000,
                        "httpGatewayEndpointPort": 19080,
                        "applicationPorts": {
                            "startPort": 20000,
                            "endPort": 30000
                        },
                        "ephemeralPorts": {
                            "startPort": 49152,
                            "endPort": 65534
                        },
                        "isPrimary": true,
                        "vmInstanceCount": 5,
                        "reverseProxyEndpointPort": 19081,
                        "durabilityLevel": "Silver"
                    }
                ],
                "vmImage": "Windows",
                "reliabilityLevel": "Silver",
                "reverseProxyCertificate": {
                    "thumbprint": "0D5877EE8C4B2210CA24650231D3ABF6366BAE11",
					"thumbprintSecondary": "FA8709B847D12560ED37A278A8367A93F3B81D74",
                    "x509StoreName": "My"
                },
                "upgradeMode": "Automatic",
                "availableClusterVersions": [
                    {
                        "codeVersion": "6.0.232.9494",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                    }
                ],
                "addonFeatures": []
            }
        }
    ]
}
```
